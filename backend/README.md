# Plum Framework Backend

Сервер для приложения Plum Framework.

## Основные используемые технологии и библиотеки

- **Python** v3.12.1;
- **poetry** v1.8.3 - менеджер пакетов;
- **FastAPI** - фреймворк для создания API;
- **SQLAlchemy** - ORM;
- **asyncpg** - асинхронное взаимодействие с PostgreSQL;
- **pydantic** - схемы данных;
- **orjson** - сериализация данных.

# Запуск сервера

1. Установить Python 3.12.1

1.1 Инструкция для Windows

Скачать [инсталлятор](https://www.python.org/ftp/python/3.12.1/python-3.12.1-amd64.exe) и запустить его для установки
Python 3.12.1

1.2 Инструкция для Linux

Если `pyenv` не установлен, выполнить команду:

```bash
curl https://pyenv.run | bash
```

Установить Python нужной версии:

```bash
pyenv install 3.12.1
```

```bash
pyenv global 3.12.1
```

Проверить, что используется нужная версия:

```bash
python --version
```

2. Создать venv

```bash
python -m venv venv
```

3. Активировать созданный venv

```bash
source ./venv/bin/activate
```

4. Установить зависимости через [poetry](https://python-poetry.org/docs/)

```bash
poetry install
```

5. Создать файл `.env` в папке `app` на основе файла `.env.template`:

```bash
cd ./app
cp ./env.template .env
```

Заполнить файл `.env`, используя следующую таблицу:

##### Параметры backend'а

| Параметр                        | Описание                                                                                                 | Значение по умолчанию или пример значения         |
|---------------------------------|----------------------------------------------------------------------------------------------------------|---------------------------------------------------|
| APP_CONFIG__DB__URL             | Строка для подключения к базе данных                                                                     | `postgresql+asyncpg://user:pwd@localhost:5432/db` |
| APP_CONFIG__DB__DATABASE_SCHEMA | Используемая схема в базе данных                                                                         | `fw`                                              |
| APP_CONFIG__DB__ECHO            | Определяет, нужно ли в консоли выводить совершаемые SQL запросы. Допустимые значение: 0 и 1.             | `0`                                               |
| APP_CONFIG__RUN__HOST           | Адрес хоста, на котором нужно запустить сервер                                                           | `127.0.0.1`                                       |
| APP_CONFIG__RUN__PORT           | Порт, на котором нужно запустить сервер                                                                  | `8001`                                            |
| APP_CONFIG__RUN__ALLOWED_ORIGIN | Origin, для которого разрешено слать запросы на сервер. Необязательное поле при запуске проекта локально | `http://192.168.1.46:5173`                        |

6. Для базы данных создать необходимые сущности, используя инструкцию из файла [sql_db.md](sql_db.md)

7. Перейти в папку `app`

```bash
cd ./app
```

8. Запустить сервер

```bash
python ./main.py
```

9. После запуска сервера можно открыть документацию сервера по адресу:  
   http://127.0.0.1:8001/docs
